// ищем всякие классы :)
var tabs = document.querySelector('.app__tab'),
		toggleOpenPopup = document.querySelector('.reserve-detail-info-wechat'),
		overleyPopup = document.querySelector('.wechat-public-box-wrapper'),
		popupQr = document.querySelector('.wechat-public-box'),
		tipReserve = document.querySelector('.reserve-form-tips-reserve'),
		tipLogin = document.querySelector('.reserve-form-tips-login'),
		reserveBtnReserve = document.querySelector('.reserve-form-btn-reserve'),
		reserveBtnLogin = document.querySelector('.reserve-form-btn-login'),
		inputSecond = document.querySelector('.reserve-form-input-second'),
		inputThird = document.querySelector('.reserve-form-input-third'),
		inputFourth = document.querySelector('.reserve-form-input-fourth');
		inputBtn = document.querySelector('.reserve-form-input-btn'),
		btnLogin = document.querySelector('#button-login'),
		cabinetWrapper = document.querySelector('.cabinet-wrapper'),
		mainForm = document.querySelector('.reserve-form');

// функция, которая показует блок таба
function openBlock(evt, blockName) {
  var tabcontent, tablinks;
	// всем блокам дисплей ноун
  tabcontent = document.getElementsByClassName("app__tabcontent");
  for (var i = 0, length = tabcontent.length; i < length; i++) {
    tabcontent[i].style.display = "none";
  }
	// всем ссылкам убираем класс эктив
  tablinks = document.getElementsByClassName("app__tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(blockName).style.display = "block";
	// на кливнувший элемент даем класс эктив 
  evt.classList.add('active');
}
// делегирование событий на обертку табов, чекам на какой нажали, достаем из
// него дата атрибут, в котором лежит название айдишника блока, который
// нужно открыть
tabs.addEventListener('click', function(event){
	var target = event.target;
	// если на кликнувший элемент нажали и в нем нет класса то выходим
	if(target.classList.contains('app__tablink')) {
		var blockName = target.getAttribute('data-name');
		openBlock(target, blockName);
		return true;
	}
	return false;
});

// авторизация
btnLogin.addEventListener('click', function() {
	// получаем данные из формы 
	// через ajax отправляем их
	// и если все ок возращаем данные о пользователе
	// и его друзьях и вставляем в загатовленный шаблон
	mainForm.remove();
	var cabinet = `<div class="cabinet">
			<div class="cabinet-user">
				<p class="cabinet-user__id">My reservation indormation <span>150000019704</span></p>
				<div class="cabinet-user__btns">
					<a href="#" class="cabinet-user__btn cabinet-user__btns-logout">logout</a>
					<a href="#" class="cabinet-user__btn cabinet-user__btns-invite">invite friends</a>
				</div>
			</div>
			<div class="cabinet-info all-reserve-info">
				<p>invation code:<span>922432</span></p>
				<p>estimated reward:<span>759 FBC</span></p>
				<p>my friends:<span>0</span> <span class="btn-view-friends">view</span></p>
				<p>my team:<span>0</span></p>
			</div>
			<div class="cabinet__friends">
				<div class="cabinet__friends-wrapper">
					<table class="cabinet__friends-table">
						<tbody>
							<tr class="cabinet__friends-table-titles">
								<th>registration time</th>
								<th>friend phone number</th>
								<th>his friends</th>
							</tr>
							<tr class="cabinet__friends-info">
								<td>23.03.2019 13:34:13</td>
								<td>1502300019704</td>
								<td>23</td>
							</tr>
							<tr class="cabinet__friends-info">
								<td>23.03.2019 13:54:13</td>
								<td>1500332d19704</td>
								<td>123123</td>
							</tr>
							<tr class="cabinet__friends-info">
								<td>23.03.2019 15:34:13</td>
								<td>150001d922204</td>
								<td>1223</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>`;

	cabinetWrapper.innerHTML = cabinet;
	// Вешаем событие клика на кнопку
	// Даем оверлею дисплей флекс и затем добавляем в стек функцию, которая
	// после того, как выйдем из функции, добавляет класс попапу, чтобы плавно вылезал
	setTimeout(function() {
		var openCabinetFriends = document.querySelector('.btn-view-friends'),
				overleyCabinetFriends = document.querySelector('.cabinet__friends'),
				popupCabinetFriends = document.querySelector('.cabinet__friends-wrapper');

		openCabinetFriends.addEventListener('click', function() {
			overleyCabinetFriends.style.display = 'flex';
			document.body.style.overflow = 'hidden';
			setTimeout(function() {
				popupCabinetFriends.classList.toggle('wechat-public-box-up');
			}, 0);
			return true;
		});
		// Вешаем события клика на оверлей попапа
		// Убираем класс, который поднмиает наш попап и через 300 мс,
		// время за которое проходит анимация, ставим обратно овердею дисплей ноун
		overleyCabinetFriends.addEventListener('click', function(event) {
			var target = event.target;

			if (target.classList.contains('cabinet__friends')) {
				popupCabinetFriends.classList.toggle('wechat-public-box-up');
				setTimeout(function() {
					overleyCabinetFriends.style.display = 'none';
					document.body.style.overflow = 'auto';
				}, 400);
				return true;
			} 
			return false;
		});
	}, 0);
});

// Вешаем событие клика на кнопку
// Даем оверлею дисплей флекс и затем добавляем в стек функцию, которая
// после того, как выйдем из функции, добавляет класс попапу, чтобы плавно вылезал
toggleOpenPopup.addEventListener('click', function() {
	overleyPopup.style.display = 'flex';
	document.body.style.overflow = 'hidden';
	setTimeout(function() {
		popupQr.classList.toggle('wechat-public-box-up');
	}, 0);
	return true;
});
// Вешаем события клика на оверлей попапа
// Убираем класс, который поднмиает наш попап и через 300 мс,
// время за которое проходит анимация, ставим обратно овердею дисплей ноун
overleyPopup.addEventListener('click', function(event) {
	var target = event.target;

	if (target.classList.contains('wechat-public-box-wrapper')) {
		popupQr.classList.toggle('wechat-public-box-up');
		setTimeout(function() {
			overleyPopup.style.display = 'none';
			document.body.style.overflow = 'auto';
		}, 400);
		return true;
	} 
	return false;
});


// показываем форму для входа
tipReserve.addEventListener('click', function() {
	reserveBtnReserve.style.display = 'none';
	reserveBtnLogin.style.display = 'block';
	tipReserve.style.display = 'none';
	tipLogin.style.display = 'block';
	inputSecond.style.display = 'none';
	inputThird.style.display = 'none';
	inputBtn.style.display = 'none';
	inputFourth.style.display = 'flex';
});
// показываем форму для регистрации
tipLogin.addEventListener('click', function() {
	reserveBtnReserve.style.display = 'block';
	reserveBtnLogin.style.display = 'none';
	tipReserve.style.display = 'block';
	tipLogin.style.display = 'none';
	inputSecond.style.display = 'flex';
	inputThird.style.display = 'flex';
	inputBtn.style.display = 'block';
	inputFourth.style.display = 'none';
});